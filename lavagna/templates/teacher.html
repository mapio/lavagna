{% extends "layout.html" %}
{% block script %}
var student = new Object();
function post_answer( e ) {
	var kind = $( '#kind' ).val();
	var answer = $( '#answer' ).val();
	if ( answer != '' ) $.post( '/post/answer', { 'answer': answer, 'kind': kind, 'destination': '*' } );
	$( '#answer' ).val( '' );
}
$( document ).ready( function () {
	
	$( 'td' ).mousemove( function ( event ) {
		if ( $(this)[ 0 ].id ) {
			info = student[ $(this)[ 0 ].id ];
			if ( info ) {
				$( '#tooltip' )[ 0 ].innerHTML = info;
				$( '#tooltip' ).css( {
				    top: event.pageY + 5 + 'px',
					left: event.pageX + 5 + 'px'
				} ).show();
			}
		}
	});
	$( 'td' ).mouseleave( function () {
		$( '#tooltip' ).hide();
	});
	
	var source = new EventSource( '/stream/teacher' );
	source.onmessage = function( e ) {
		var d = JSON.parse( e.data );
		if ( d.event == 'question' )
			$( '#questions' ).after( d.question );
		else if ( d.event == 'seat' ) {

			elem = document.getElementById( d.location );
			if ( elem ) {
				student[ d.location ] = d.student;
				elem.style.background = 'green';
					/*
					$( elem ).animate( { opacity: 'toggle' }, 'fast' );
					$( elem ).animate( { opacity: 'toggle' }, 'fast' );
					*/
			}

		}
	};
} );
{% endblock %}
{% block body %}

<div id="tooltip">&nbsp;</div>

{{ rooms|safe }}<div style="clear: both;"></div>

<p>Hint:</p>
<form action="#" method="post">
	<textarea rows=4 cols=80 id="answer"></textarea>
	<select id="kind">
		<option selected>text</option>
		<option>code</option>
		<option>html</option>
	</select>
	<button type="button" onclick="post_answer(); return false;">Post</button>
</form>
<p id="questions">Questions:</p>
{% endblock %}
