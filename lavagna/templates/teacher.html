{% extends "layout.html" %}
{% block script %}
var student = new Object();
function post_answer( e ) {
	var kind = $( '#kind' ).val();
	var answer = $( '#answer' ).val();
	if ( answer != '' ) $.post( '/post/answer', { 'answer': answer, 'kind': kind, 'destination': '*' } );
	$( '#answer' ).val( '' );
}
$( document ).ready( function () {
	
	var source = new EventSource( '/stream/map' );
	source.onmessage = function( e ) {
		infos = e.data.split( '@' );
		elem = document.getElementById( infos[ 2 ] );
		if ( elem ) {
			student[ infos[ 2 ] ] = infos[ 1 ];
			if ( infos[ 0 ] == 'token' )
				elem.style.background = 'green';
			else {
				$( elem ).animate( { opacity: 'toggle' }, 'fast' );
				$( elem ).animate( { opacity: 'toggle' }, 'fast' );
				elem.style.background = 'red';
			}
		}
	};
	$( 'td' ).mousemove( function ( event ) {
		if ( $(this)[ 0 ].id ) {
			info = student[ $(this)[ 0 ].id ];
			if ( info ) {
				$( '#tooltip' )[ 0 ].innerHTML = info;
				$( '#tooltip' ).css( {
				    top: event.pageY + 5 + 'px',
					left: event.pageX + 5 + 'px'
				} ).show();
			}
		}
	});
	$( 'td' ).mouseleave( function () {
		$( '#tooltip' ).hide();
	});
	
	
	
	
	var source = new EventSource( '/stream/teacher' );
	source.onmessage = function( e ) {
		var d = JSON.parse( e.data );
		if ( d.event == 'question' )
			$( '#questions' ).after( d.question );
		else if ( d.event == 'seat' ){
		
		}
	};
} );
{% endblock %}
{% block body %}

<div id="tooltip">&nbsp;</div>

{{ maps|safe }}<div style="clear: both;"></div>

<p>Hint:</p>
<form action="#" method="post">
	<textarea rows=4 cols=80 id="answer"></textarea>
	<select id="kind">
		<option selected>text</option>
		<option>code</option>
		<option>html</option>
	</select>
	<button type="button" onclick="post_answer(); return false;">Post</button>
</form>
<p id="questions">Questions:</p>
{% endblock %}
