{% extends "layout.html" %}
{% block script %}
$( document ).ready( function () {
	var source = new EventSource( '/stream/student' );
	source.onmessage = function( e ) {
		var d = JSON.parse( e.data );
		if ( d.destination != '*' && d.destination != '{{ location }}' ) return;
		if ( d.kind == 'text' )
			content = '<pre style="white-space: pre-wrap;">' + d.answer + '</pre>';
		else if ( d.kind == 'code' )
			content = '<pre class="pp">' + d.answer + '</pre>';
		else content = d.answer;		
		$( '#hints' ).after( '<fieldset><legend>' + d.now + '</legend>' + content + '</fieldset>' );
		if ( d.kind == 'code' ) prettyPrint();
	};
	$( '#question' ).keyup( function( e ) {
		if ( e.keyCode == 13 ) {
			var question = $( this ).val();
			if ( question != '' ) $.post( '/post/question', { 'question': question } );
			$( this ).val( '' );
		}
	} );
} );
{% endblock %}
{% block body %}
	<p>Student: <b>{{ student }}</b> @ <b>{{ location }}</b>.</p>
	<p>Question: <input id="question" size=120/></p>
	<p id="hints">Hints:</p>
{% endblock %}
